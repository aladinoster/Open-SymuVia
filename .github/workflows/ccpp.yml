name: Build SymuCore SymuVia

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  ###########################
  # BUILDING ON LINUX
  ###########################
  
  build-linux:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        compiler: [gcc, clang]

    steps:
    - name: Checkout SymuVia
      uses: actions/checkout@v2
      with:
        path: symuvia

    - name: Preparing Build System
      run: |
        sudo apt-get update 
        sudo apt-get install cmake xqilla libboost-all-dev aptitude gdal-bin rapidjson-dev libgdal-dev unixodbc
        aptitude search -y boost
      
    - name: Listing libraries 
      run: |
        ls -alh /usr/include/
        ls -alh /usr/include/x86_64-linux-gnu
        
    - name: Building SymuVia
      run: |
        mkdir -p symuvia/cmake-build 
        cd symuvia/cmake-build 
        if [[ "${{ matrix.compiler }}" == "gcc" ]]; then sudo CC=gcc CXX=g++ cmake ..; fi
        if [[ "${{ matrix.compiler }}" == "clang" ]]; then sudo CC=clang CXX=clang++ cmake ..; fi        
        sudo make -j2        

  ###################
  # BUILDING ON OSX
  ###################
  build-osx:
    runs-on: macos-latest
    steps:
    - name: Checkout SymuVia
      uses: actions/checkout@v2
      with:
        path: symuvia
        
    - name: Preparing Build System
      run: |
        brew update
        brew install cmake boost boost-python3 gdal xqilla rapidjson python

    - name: Building SymuVia
      run: |
        mkdir -p symuvia/cmake-build 
        cd symuvia/cmake-build 
        cmake .. 
        make -j2
